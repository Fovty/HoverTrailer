<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HoverTrailer</title>
</head>
<body>
    <div id="HoverTrailerConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <style>
            .hovertrailer-header {
                margin-bottom: 2em;
                padding: 1em;
                background-color: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                border-left: 4px solid #00a4dc;
            }
            .hovertrailer-header h2 {
                margin: 0 0 0.5em 0;
                color: #00a4dc;
                font-weight: 600;
            }
            .hovertrailer-header .recommendation {
                margin: 0;
                font-size: 0.9em;
                opacity: 0.9;
            }
            .hovertrailer-header .recommendation a {
                color: #00a4dc;
                font-weight: bold;
                text-decoration: none;
            }
            .hovertrailer-header .recommendation a:hover {
                text-decoration: underline;
            }
            .hovertrailer-fieldset {
                margin-bottom: 2.5em;
                border: 1px solid rgba(0, 164, 220, 0.2);
                border-radius: 8px;
                padding: 0;
                background-color: rgba(255, 255, 255, 0.02);
            }
            .hovertrailer-legend {
                padding: 0.5em 1em;
                margin: 0 1em;
                background-color: rgba(0, 164, 220, 0.1);
                border: 1px solid rgba(0, 164, 220, 0.3);
                border-radius: 4px;
                color: #00a4dc;
                font-weight: 600;
                font-size: 1.1em;
            }
            .hovertrailer-fieldset-content {
                padding: 1.5em;
            }
            .hovertrailer-section-description {
                margin-bottom: 1.5em;
                padding: 0.75em;
                background-color: rgba(255, 255, 255, 0.05);
                border-radius: 4px;
                font-size: 0.9em;
                opacity: 0.9;
            }
            .checkboxContainer {
                margin-bottom: 1.5em;
            }
            .checkboxContainer-withDescription {
                margin-bottom: 1.5em;
            }
            .checkboxContainer .fieldDescription {
                margin-top: 0.5em;
                margin-left: 1.5em;
            }
            .inputContainer {
                margin-bottom: 1.5em;
            }
            .selectContainer {
                margin-bottom: 1.5em;
            }
            .hovertrailer-save-container {
                margin-top: 2em;
                padding-top: 1.5em;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
        </style>
        <div data-role="content">
            <div class="content-primary">
                <form id="HoverTrailerConfigForm">
                    <!-- Header Section -->
                    <div class="hovertrailer-header">
                        <h2>HoverTrailer Plugin Configuration</h2>
                        <p class="recommendation">
                            <strong>Recommendation:</strong> For downloading trailers, consider using
                            <a href="https://github.com/nandyalu/trailarr" target="_blank">trailarr</a>
                            to automatically download and organize trailers for your media library.
                        </p>
                    </div>

                    <!-- Hover Preview Settings -->
                    <fieldset class="hovertrailer-fieldset verticalSection-extrabottompadding">
                        <legend class="hovertrailer-legend">Hover Preview Settings</legend>
                        <div class="hovertrailer-fieldset-content">
                            <div class="hovertrailer-section-description">
                                Configure the basic behavior and timing of hover preview functionality.
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="EnableHoverPreview" name="EnableHoverPreview" type="checkbox" is="emby-checkbox" />
                                    <span>Enable Hover Preview Feature</span>
                                </label>
                                <div class="fieldDescription">Enable hover preview functionality for movie cards</div>
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="InjectClientScript" name="InjectClientScript" type="checkbox" is="emby-checkbox" />
                                    <span>Inject Client Script</span>
                                </label>
                                <div class="fieldDescription">Inject client-side script for hover preview functionality</div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="HoverDelayMs">Hover Delay (ms)</label>
                                <input id="HoverDelayMs" name="HoverDelayMs" type="number" min="100" max="10000" is="emby-input" />
                                <div class="fieldDescription">Delay before showing hover preview (100-10000 milliseconds)</div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewDurationMs">Preview Duration (ms)</label>
                                <input id="PreviewDurationMs" name="PreviewDurationMs" type="number" min="5000" max="60000" is="emby-input" />
                                <div class="fieldDescription">How long to show the preview (5000-60000 milliseconds)</div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Hover Preview Customization -->
                    <fieldset class="hovertrailer-fieldset verticalSection-extrabottompadding">
                        <legend class="hovertrailer-legend">Hover Preview Customization</legend>
                        <div class="hovertrailer-fieldset-content">
                            <div class="hovertrailer-section-description">
                                Customize the appearance, positioning, and sizing of hover previews.
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewOffsetX">Horizontal Offset (px)</label>
                                <input id="PreviewOffsetX" name="PreviewOffsetX" type="number" min="-2000" max="2000" is="emby-input" />
                                <div class="fieldDescription">Horizontal offset from default position (-2000 to +2000 pixels)</div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewOffsetY">Vertical Offset (px)</label>
                                <input id="PreviewOffsetY" name="PreviewOffsetY" type="number" min="-2000" max="2000" is="emby-input" />
                                <div class="fieldDescription">Vertical offset from default position (-2000 to +2000 pixels)</div>
                            </div>

                            <div class="selectContainer">
                                <label class="selectLabel" for="PreviewSizingMode">Sizing Mode</label>
                                <select id="PreviewSizingMode" name="PreviewSizingMode" is="emby-select" class="emby-select-withcolor emby-select">
                                    <option value="Manual">Manual (Set Width & Height)</option>
                                    <option value="FitContent">Fit to Video Content</option>
                                </select>
                                <div class="fieldDescription">Choose how to size the preview window</div>
                            </div>

                            <div class="inputContainer" id="manualSizeContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewWidth">Preview Width (px)</label>
                                <input id="PreviewWidth" name="PreviewWidth" type="number" min="200" max="800" is="emby-input" />
                                <div class="fieldDescription">Width of the preview window (200-800 pixels)</div>
                            </div>

                            <div class="inputContainer" id="manualSizeContainer2">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewHeight">Preview Height (px)</label>
                                <input id="PreviewHeight" name="PreviewHeight" type="number" min="150" max="600" is="emby-input" />
                                <div class="fieldDescription">Height of the preview window (150-600 pixels)</div>
                            </div>

                            <div class="inputContainer" id="fitContentSizeContainer" style="display: none;">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewSizePercentage">Content Scale Percentage (%)</label>
                                <input id="PreviewSizePercentage" name="PreviewSizePercentage" type="number" min="50" max="1500" step="10" is="emby-input" />
                                <div class="fieldDescription">Scale the content-fitted preview size (50-1500%)</div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewOpacity">Preview Opacity</label>
                                <input id="PreviewOpacity" name="PreviewOpacity" type="number" min="0" max="1.0" step="0.1" is="emby-input" />
                                <div class="fieldDescription">Transparency of the preview (0.0 = transparent, 1.0 = opaque)</div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="PreviewBorderRadius">Border Radius (px)</label>
                                <input id="PreviewBorderRadius" name="PreviewBorderRadius" type="number" min="0" max="50" is="emby-input" />
                                <div class="fieldDescription">Rounded corners for the preview (0-50 pixels)</div>
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="EnablePreviewAudio" name="EnablePreviewAudio" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox">
                                    <span class="checkboxLabel">Enable Preview Audio</span>
                                <span class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span><span class="material-icons checkboxIcon checkboxIcon-unchecked " aria-hidden="true"></span></span></label>
                                <div class="fieldDescription">Allow sound to play during trailer previews</div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Debug Settings -->
                    <fieldset class="hovertrailer-fieldset verticalSection-extrabottompadding">
                        <legend class="hovertrailer-legend">Debug Settings</legend>
                        <div class="hovertrailer-fieldset-content">
                            <div class="hovertrailer-section-description">
                                Enable debugging features to help troubleshoot issues with the plugin.
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="EnableDebugLogging" name="EnableDebugLogging" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox">
                                    <span class="checkboxLabel">Enable Debug Mode</span>
                                <span class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span><span class="material-icons checkboxIcon checkboxIcon-unchecked " aria-hidden="true"></span></span></label>
                                <div class="fieldDescription">Enable detailed logging for troubleshooting purposes</div>
                            </div>
                        </div>
                    </fieldset>

                    <div class="hovertrailer-save-container">
                        <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var HoverTrailerConfig = {
                pluginUniqueId: 'F0VTY101-H0VR-TRL1-JFIN-123456789ABC'
            };

            function loadConfiguration() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(HoverTrailerConfig.pluginUniqueId).then(function (config) {
                    // Hover Preview Settings
                    document.querySelector('#EnableHoverPreview').checked = config.EnableHoverPreview !== false;
                    document.querySelector('#InjectClientScript').checked = config.InjectClientScript !== false;
                    document.querySelector('#HoverDelayMs').value = config.HoverDelayMs || 1000;
                    document.querySelector('#PreviewDurationMs').value = config.PreviewDurationMs || 30000;

                    // Hover Preview Customization
                    document.querySelector('#PreviewOffsetX').value = config.PreviewOffsetX || 0;
                    document.querySelector('#PreviewOffsetY').value = config.PreviewOffsetY || 0;
                    document.querySelector('#PreviewSizingMode').value = config.PreviewSizingMode || 'Manual';
                    document.querySelector('#PreviewWidth').value = config.PreviewWidth || 300;
                    document.querySelector('#PreviewHeight').value = config.PreviewHeight || 200;
                    document.querySelector('#PreviewSizePercentage').value = config.PreviewSizePercentage || 100;
                    document.querySelector('#PreviewOpacity').value = config.PreviewOpacity || 0.9;
                    document.querySelector('#PreviewBorderRadius').value = config.PreviewBorderRadius || 8;
                    document.querySelector('#EnablePreviewAudio').checked = config.EnablePreviewAudio || false;

                    // Update sizing mode visibility
                    updateSizingModeVisibility();

                    // Debug Settings
                    document.querySelector('#EnableDebugLogging').checked = config.EnableDebugLogging || false;

                    Dashboard.hideLoadingMsg();
                }).catch(function (error) {
                    console.error('Error loading configuration:', error);
                    Dashboard.hideLoadingMsg();
                });
            }

            function saveConfiguration() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(HoverTrailerConfig.pluginUniqueId).then(function (config) {
                    // Hover Preview Settings
                    config.EnableHoverPreview = document.querySelector('#EnableHoverPreview').checked;
                    config.InjectClientScript = document.querySelector('#InjectClientScript').checked;
                    config.HoverDelayMs = parseInt(document.querySelector('#HoverDelayMs').value) || 1000;
                    config.PreviewDurationMs = parseInt(document.querySelector('#PreviewDurationMs').value) || 30000;

                    // Hover Preview Customization
                    config.PreviewOffsetX = parseInt(document.querySelector('#PreviewOffsetX').value) || 0;
                    config.PreviewOffsetY = parseInt(document.querySelector('#PreviewOffsetY').value) || 0;
                    config.PreviewSizingMode = document.querySelector('#PreviewSizingMode').value || 'Manual';
                    config.PreviewWidth = parseInt(document.querySelector('#PreviewWidth').value) || 300;
                    config.PreviewHeight = parseInt(document.querySelector('#PreviewHeight').value) || 200;
                    config.PreviewSizePercentage = parseInt(document.querySelector('#PreviewSizePercentage').value) || 100;
                    config.PreviewOpacity = parseFloat(document.querySelector('#PreviewOpacity').value) || 0.9;
                    config.PreviewBorderRadius = parseInt(document.querySelector('#PreviewBorderRadius').value) || 8;
                    config.EnablePreviewAudio = document.querySelector('#EnablePreviewAudio').checked;

                    // Debug Settings
                    config.EnableDebugLogging = document.querySelector('#EnableDebugLogging').checked;

                    ApiClient.updatePluginConfiguration(HoverTrailerConfig.pluginUniqueId, config).then(function (result) {
                        Dashboard.processPluginConfigurationUpdateResult(result);
                    }).catch(function (error) {
                        console.error('Error saving configuration:', error);
                        Dashboard.hideLoadingMsg();
                        Dashboard.alert('Error saving configuration: ' + error.message);
                    });
                }).catch(function (error) {
                    console.error('Error loading configuration for save:', error);
                    Dashboard.hideLoadingMsg();
                    Dashboard.alert('Error loading configuration: ' + error.message);
                });
            }

            function updateSizingModeVisibility() {
                const sizingMode = document.querySelector('#PreviewSizingMode').value;
                const manualContainer = document.querySelector('#manualSizeContainer');
                const manualContainer2 = document.querySelector('#manualSizeContainer2');
                const fitContentContainer = document.querySelector('#fitContentSizeContainer');

                if (sizingMode === 'Manual') {
                    manualContainer.style.display = 'block';
                    manualContainer2.style.display = 'block';
                    fitContentContainer.style.display = 'none';
                } else if (sizingMode === 'FitContent') {
                    manualContainer.style.display = 'none';
                    manualContainer2.style.display = 'none';
                    fitContentContainer.style.display = 'block';
                }
            }

            document.querySelector("#HoverTrailerConfigPage").addEventListener("pageshow", () => {
                loadConfiguration();
            });

            document.querySelector("#HoverTrailerConfigForm").addEventListener("submit", (e) => {
                e.preventDefault();
                saveConfiguration();
                return false;
            });

            // Add event listener for sizing mode dropdown
            document.querySelector('#PreviewSizingMode').addEventListener('change', updateSizingModeVisibility);
        </script>
    </div>
</body>
</html>
