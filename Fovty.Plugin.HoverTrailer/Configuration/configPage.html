<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HoverTrailer</title>
</head>
<body>
    <div id="HoverTrailerConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="HoverTrailerConfigForm">
                    <!-- Header with trailarr recommendation -->
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">HoverTrailer Plugin Configuration</h2>
                    </div>

                    <div class="selectContainer">
                        <div class="fieldDescription">
                            <strong>Recommendation:</strong> For downloading trailers, consider using
                            <a href="https://github.com/nandyalu/trailarr" target="_blank">trailarr</a>
                            to automatically download and organize trailers for your media library.
                        </div>
                    </div>

                    <!-- Hover Preview Settings (existing) -->
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Hover Preview Settings</h3>
                        </div>
                        <label class="emby-checkbox-label">
                            <input id="EnableHoverPreview" name="EnableHoverPreview" type="checkbox" is="emby-checkbox" />
                            <span>Enable Hover Preview Feature</span>
                        </label>
                        <div class="fieldDescription">Enable hover preview functionality for movie cards</div>
                        <label class="emby-checkbox-label">
                            <input id="InjectClientScript" name="InjectClientScript" type="checkbox" is="emby-checkbox" />
                            <span>Inject Client Script</span>
                        </label>
                        <div class="fieldDescription">Inject client-side script for hover preview functionality</div>
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="HoverDelayMs">Hover Delay (ms):</label>
                            <input id="HoverDelayMs" name="HoverDelayMs" type="number" min="100" max="10000" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Delay before showing hover preview (100-10000 milliseconds)</div>
                        </div>
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewDurationMs">Preview Duration (ms):</label>
                            <input id="PreviewDurationMs" name="PreviewDurationMs" type="number" min="5000" max="60000" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">How long to show the preview (5000-60000 milliseconds)</div>
                        </div>
                    </div>

                    <!-- NEW: Hover Preview Customization -->
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Hover Preview Customization</h3>
                        </div>
                        <div class="fieldDescription">Customize the appearance and positioning of hover previews</div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewOffsetX">Horizontal Offset (px):</label>
                            <input id="PreviewOffsetX" name="PreviewOffsetX" type="number" min="-500" max="500" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Horizontal offset from default position (-500 to +500 pixels)</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewOffsetY">Vertical Offset (px):</label>
                            <input id="PreviewOffsetY" name="PreviewOffsetY" type="number" min="-500" max="500" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Vertical offset from default position (-500 to +500 pixels)</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewSizingMode">Sizing Mode:</label>
                            <select id="PreviewSizingMode" name="PreviewSizingMode" is="emby-select" class="emby-select">
                                <option value="Manual">Manual (Set Width & Height)</option>
                                <option value="Percentage">Percentage of Card</option>
                                <option value="FitContent">Fit to Video Content</option>
                            </select>
                            <div class="fieldDescription">Choose how to size the preview window</div>
                        </div>

                        <div class="inputContainer" id="manualSizeContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewWidth">Preview Width (px):</label>
                            <input id="PreviewWidth" name="PreviewWidth" type="number" min="200" max="800" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Width of the preview window (200-800 pixels)</div>
                        </div>

                        <div class="inputContainer" id="manualSizeContainer2">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewHeight">Preview Height (px):</label>
                            <input id="PreviewHeight" name="PreviewHeight" type="number" min="150" max="600" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Height of the preview window (150-600 pixels)</div>
                        </div>

                        <div class="inputContainer" id="percentageSizeContainer" style="display: none;">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewSizePercentage">Preview Size Percentage (%):</label>
                            <input id="PreviewSizePercentage" name="PreviewSizePercentage" type="number" min="50" max="300" step="10" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Scale the preview as a percentage of base size (50-300%)</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewOpacity">Preview Opacity:</label>
                            <input id="PreviewOpacity" name="PreviewOpacity" type="number" min="0.1" max="1.0" step="0.1" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Transparency of the preview (0.1 = mostly transparent, 1.0 = opaque)</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="PreviewBorderRadius">Border Radius (px):</label>
                            <input id="PreviewBorderRadius" name="PreviewBorderRadius" type="number" min="0" max="20" is="emby-input" class="emby-input" />
                            <div class="fieldDescription">Rounded corners for the preview (0-20 pixels)</div>
                        </div>

                        <label class="emby-checkbox-label">
                            <input id="EnablePreviewAudio" name="EnablePreviewAudio" type="checkbox" is="emby-checkbox" />
                            <span>Enable Preview Audio</span>
                        </label>
                        <div class="fieldDescription">Allow sound to play during trailer previews</div>
                    </div>

                    <!-- Debug Settings (existing) -->
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Debug Settings</h3>
                        </div>
                        <label class="emby-checkbox-label">
                            <input id="EnableDebugLogging" name="EnableDebugLogging" type="checkbox" is="emby-checkbox" />
                            <span>Enable Debug Mode</span>
                        </label>
                        <div class="fieldDescription">Enable detailed logging for troubleshooting purposes</div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var HoverTrailerConfig = {
                pluginUniqueId: '12a5d8c3-4b9e-4f2a-a1c6-8d7e9f0a1b2c'
            };

            function loadConfiguration() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(HoverTrailerConfig.pluginUniqueId).then(function (config) {
                    // Hover Preview Settings
                    document.querySelector('#EnableHoverPreview').checked = config.EnableHoverPreview !== false;
                    document.querySelector('#InjectClientScript').checked = config.InjectClientScript !== false;
                    document.querySelector('#HoverDelayMs').value = config.HoverDelayMs || 1000;
                    document.querySelector('#PreviewDurationMs').value = config.PreviewDurationMs || 30000;

                    // Hover Preview Customization
                    document.querySelector('#PreviewOffsetX').value = config.PreviewOffsetX || 0;
                    document.querySelector('#PreviewOffsetY').value = config.PreviewOffsetY || 0;
                    document.querySelector('#PreviewSizingMode').value = config.PreviewSizingMode || 'Manual';
                    document.querySelector('#PreviewWidth').value = config.PreviewWidth || 300;
                    document.querySelector('#PreviewHeight').value = config.PreviewHeight || 200;
                    document.querySelector('#PreviewSizePercentage').value = config.PreviewSizePercentage || 100;
                    document.querySelector('#PreviewOpacity').value = config.PreviewOpacity || 0.9;
                    document.querySelector('#PreviewBorderRadius').value = config.PreviewBorderRadius || 8;
                    document.querySelector('#EnablePreviewAudio').checked = config.EnablePreviewAudio || false;

                    // Update sizing mode visibility
                    updateSizingModeVisibility();

                    // Debug Settings
                    document.querySelector('#EnableDebugLogging').checked = config.EnableDebugLogging || false;

                    Dashboard.hideLoadingMsg();
                }).catch(function (error) {
                    console.error('Error loading configuration:', error);
                    Dashboard.hideLoadingMsg();
                });
            }

            function saveConfiguration() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(HoverTrailerConfig.pluginUniqueId).then(function (config) {
                    // Hover Preview Settings
                    config.EnableHoverPreview = document.querySelector('#EnableHoverPreview').checked;
                    config.InjectClientScript = document.querySelector('#InjectClientScript').checked;
                    config.HoverDelayMs = parseInt(document.querySelector('#HoverDelayMs').value) || 1000;
                    config.PreviewDurationMs = parseInt(document.querySelector('#PreviewDurationMs').value) || 30000;

                    // Hover Preview Customization
                    config.PreviewOffsetX = parseInt(document.querySelector('#PreviewOffsetX').value) || 0;
                    config.PreviewOffsetY = parseInt(document.querySelector('#PreviewOffsetY').value) || 0;
                    config.PreviewSizingMode = document.querySelector('#PreviewSizingMode').value || 'Manual';
                    config.PreviewWidth = parseInt(document.querySelector('#PreviewWidth').value) || 300;
                    config.PreviewHeight = parseInt(document.querySelector('#PreviewHeight').value) || 200;
                    config.PreviewSizePercentage = parseInt(document.querySelector('#PreviewSizePercentage').value) || 100;
                    config.PreviewOpacity = parseFloat(document.querySelector('#PreviewOpacity').value) || 0.9;
                    config.PreviewBorderRadius = parseInt(document.querySelector('#PreviewBorderRadius').value) || 8;
                    config.EnablePreviewAudio = document.querySelector('#EnablePreviewAudio').checked;

                    // Debug Settings
                    config.EnableDebugLogging = document.querySelector('#EnableDebugLogging').checked;

                    ApiClient.updatePluginConfiguration(HoverTrailerConfig.pluginUniqueId, config).then(function (result) {
                        Dashboard.processPluginConfigurationUpdateResult(result);
                    }).catch(function (error) {
                        console.error('Error saving configuration:', error);
                        Dashboard.hideLoadingMsg();
                        Dashboard.alert('Error saving configuration: ' + error.message);
                    });
                }).catch(function (error) {
                    console.error('Error loading configuration for save:', error);
                    Dashboard.hideLoadingMsg();
                    Dashboard.alert('Error loading configuration: ' + error.message);
                });
            }

            function updateSizingModeVisibility() {
                const sizingMode = document.querySelector('#PreviewSizingMode').value;
                const manualContainer = document.querySelector('#manualSizeContainer');
                const manualContainer2 = document.querySelector('#manualSizeContainer2');
                const percentageContainer = document.querySelector('#percentageSizeContainer');

                if (sizingMode === 'Manual') {
                    manualContainer.style.display = 'block';
                    manualContainer2.style.display = 'block';
                    percentageContainer.style.display = 'none';
                } else if (sizingMode === 'Percentage') {
                    manualContainer.style.display = 'none';
                    manualContainer2.style.display = 'none';
                    percentageContainer.style.display = 'block';
                } else if (sizingMode === 'FitContent') {
                    manualContainer.style.display = 'none';
                    manualContainer2.style.display = 'none';
                    percentageContainer.style.display = 'none';
                }
            }

            document.querySelector("#HoverTrailerConfigPage").addEventListener("pageshow", () => {
                loadConfiguration();
            });

            document.querySelector("#HoverTrailerConfigForm").addEventListener("submit", (e) => {
                e.preventDefault();
                saveConfiguration();
                return false;
            });

            // Add event listener for sizing mode dropdown
            document.querySelector('#PreviewSizingMode').addEventListener('change', updateSizingModeVisibility);
        </script>
    </div>
</body>
</html>